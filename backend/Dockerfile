FROM tensorflow/tensorflow:1.13.2-py3

WORKDIR /dreambox/backend

COPY poetry.lock pyproject.toml ./

RUN apt update && apt install -y curl

RUN pip install --upgrade keyrings.alt \  # Can't run any poetry command otherwise.
 && pip install poetry \
 && poetry config settings.virtualenvs.create false \
 && poetry install $(test "$ENV" = "production" && echo "--no-dev") --no-interaction

COPY . .

CMD ./run.sh
